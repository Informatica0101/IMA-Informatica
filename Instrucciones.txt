Importante:
PROHIBIDO AGREGAR CONTENIDO ANTES DEL SIGUIENTE BLOQUE DE TEXTO.

— PROCEDIMIENTO OBLIGATORIO DE TRABAJO.
===================================================================

Este procedimiento es de CUMPLIMIENTO OBLIGATORIO en TODOS los proyectos.
No se permite omitir, alterar ni reordenar pasos.

--------------------------------------------------
FLUJO PRINCIPAL DE TRABAJO
--------------------------------------------------

1. AUDITORÍA INICIAL DEL ARCHIVO
   - Auditar el/los archivo(s) involucrados.
   - Revisión archivo por archivo.
   - Revisión línea por línea.
   - Identificar estado actual, riesgos, dependencias y efectos colaterales.
   - PROHIBIDO modificar código en esta etapa.

2. REGISTRO DE HALLAZGOS
   - Registrar TODOS los hallazgos en Auditoría.txt.
   - Crear nueva entrada o actualizar la existente.
   - PROHIBIDO eliminar información previa.
   - NO realizar correcciones durante la auditoría.

3. MANEJO DE HALLAZGOS FUERA DE ALCANCE
   - Si se detectan problemas fuera de la tarea actual:
     a) Resolverlos en el MISMO commit SOLO si es seguro.
     b) Si no es posible:
        -> Registrar nueva tarea en Instrucciones.txt
        -> Referenciarla en Auditoría.txt

4. RESPALDO OBLIGATORIO ANTES DE EDICIÓN
   - Crear copia exacta del/los archivo(s) a modificar.
   - El respaldo DEBE conservar:
     · Nombre original
     · Contenido íntegro
   - El respaldo se usa EXCLUSIVAMENTE para comparación posterior.

5. EJECUCIÓN DE LA TAREA
   - Implementar ÚNICAMENTE lo solicitado.
   - PROHIBIDO:
     · Cambiar estilos no relacionados
     · Alterar flujos existentes
     · Introducir optimizaciones no solicitadas
   - Todo cambio debe estar justificado por la tarea.

6. VERIFICACIÓN FUNCIONAL
   - Confirmar que la tarea cumple su objetivo.
   - Verificar que no se rompan funciones existentes.
   - Probar flujos relacionados directa e indirectamente.

7. COMPARACIÓN POST-EDICIÓN (OBLIGATORIA)
   - Comparar archivo editado contra el respaldo previo.
   - Identificar:
     · Líneas eliminadas
     · Líneas modificadas
     · Bloques sobreescritos
   - Verificar que:
     -> TODO cambio esté directamente relacionado con la tarea.
   - Si se detectan cambios ajenos:
     -> REVERTIRLOS inmediatamente
     -> Repetir la comparación
-Los archivos de Respaldo se debe eliminar DESPUES de la revision de codigo de Code Review.
-Todo archivo, captura generado para la verificación visual o ejecutable debe de ser eliminado en el pre-commit.

8. VERIFICACIÓN DE INTEGRIDAD Y EFECTOS COLATERALES
   - Revisar dependencias internas y externas.
   - Detectar efectos colaterales visuales o lógicos.
   - Confirmar que no existen regresiones.

9. REVISIÓN FINAL DE CÓDIGO
   - Revisar nuevamente el archivo completo modificado:
     - Línea por línea
     - Función por función
   - Validar coherencia, legibilidad y cumplimiento de reglas.

10. REGISTRO EN CHANGESLOGS.TXT
    - Registrar TODOS los cambios realizados.
    - Indicar:
      · Archivo modificado
      · Líneas afectadas
      · Descripción objetiva
    - PROHIBIDO asumir éxito o usar frases de cierre.

11. ACTUALIZACIÓN DE INSTRUCCIONES.TXT
    - Mover la tarea ejecutada a:
      -> "TAREAS PENDIENTES DE REVISIÓN"
tarea 28: Optimización visual del Dashboard del Profesor (Reducir márgenes, ajustar columnas, reposicionar buscador y botón regresar). (COMPLETADA)
    - NO eliminar tareas sin aprobación del PM.

12. COMMIT
    - Realizar UN SOLO commit por ciclo completo.
    - El commit DEBE reflejar EXACTAMENTE
      lo auditado y documentado.

-----------------------------------------------
EXTENSIÓN OBLIGATORIA POR CODE REVIEW
--------------------------------------------------

Si el Code Review detecta:
- Fallas
- Bloqueantes
- Riesgos
- Cambios requeridos

ENTONCES:
-> Este MISMO procedimiento DEBE aplicarse nuevamente
-> Incluso si implica modificar archivos ya editados
-> NO se permiten correcciones parciales


==================================================
PROTOCOLO DE RESULTADO DE CODE REVIEW
==================================================

--------------------------------------------------
FLUJO DE ANÁLISIS
--------------------------------------------------

1. LECTURA COMPLETA DEL CODE REVIEW
   - Leer TODO el informe.
   - No omitir secciones.

2. SAFETY & SIDE EFFECTS
   - Se considera FUENTE DE VERDAD PRINCIPAL.
   - SOLO se ignora si el Code Review solicita
     explícitamente revertir cambios.

--------------------------------------------------
TRATAMIENTO DE REVERSIÓN
--------------------------------------------------

3. EVALUACIÓN OBLIGATORIA

   a) CAMBIOS "OUT OF SCOPE"
      - Verificar si pertenecen a:
        · Tareas anteriores
        · Commits previos aprobados

      - Si pertenecen a tareas anteriores:
        -> IGNORAR solicitud de reversión
        -> CONTINUAR con el commit actual

   b) CAMBIOS DE LA TAREA ACTUAL
      - Si los cambios NO solicitados
        fueron introducidos durante la tarea actual:
        -> REALIZAR reversión
        -> REGISTRAR el motivo

--------------------------------------------------
IMPACTO EN EL FLUJO
--------------------------------------------------

4. REINICIO DEL CICLO
   - Toda observación que implique cambios:
     -> REINICIA el ciclo completo
        desde la AUDITORÍA INICIAL

   - El reinicio NO afecta:
     · Commits anteriores
     · Tareas aprobadas
     · Cambios fuera de alcance


--------------------------------------------------
DOCUMENTACIÓN OBLIGATORIA
--------------------------------------------------

Toda acción derivada del Code Review
DEBE quedar registrada en:
- Auditoría.txt
- ChangesLogs.txt
- Instrucciones.txt (si aplica)


--------------------------------------------------
REGLA FINAL ABSOLUTA
--------------------------------------------------

SI NO SE AUDITA, NO SE CAMBIA.
SI NO SE REGISTRA, NO EXISTE.

El incumplimiento de CUALQUIER paso
INVALIDA el proceso completo.

==================================================
TAREAS
=================================================

Despues de esta linea se deben de registrar las nuevas tareas, por realizar o completadas

________________________________________________________________________________________________
TAREAS COMPLETADAS (ÁREA PROTEGIDA - NO MODIFICAR)
________________________________________________________________________________________________
tarea 1: Implementar subida múltiple de imágenes una por una con vista previa y carga en segundo plano. (COMPLETADA)
tarea 2: Actualizar URL del microservicio TASK. (COMPLETADA)
tarea 3: Optimizar UX de carga en segundo plano (no bloqueante) y corregir backend. (COMPLETADA)
tarea 4: Actualización recurrente de la URL del microservicio TASK. (COMPLETADA)
tarea 5: Garantizar la integridad de subidas concurrentes en el dashboard del estudiante. (COMPLETADA)
tarea 6: Implementar animaciones de carga en todos los botones de envío al backend y corregir error de entrega de exámenes. (COMPLETADA)
tarea 7: Estandarizar formato de fechas a ISO 8601 en servicios de backend para corregir "Invalid Date" en el frontend. (COMPLETADA)
tarea 8: Auditar cambios finales, corregir variables obsoletas y aplicar nuevas URLs de servicios. (COMPLETADA)
tarea 10: Implementar búsqueda, filtrado y ordenamiento en el dashboard del profesor, restringir resultados de examen a estudiantes y habilitar calificación manual de exámenes. (COMPLETADA)
tarea 24: Reestructurar navegación del dashboard del profesor (Grados -> Sección -> Asignatura -> Alumno). (COMPLETADA)
tarea 25: Implementar vista de detalle del alumno con estados Completada/Pendiente/Por calificar. (COMPLETADA)
tarea 26: Implementar tabla de alumnos resumida con reordenamiento asc/desc. (COMPLETADA)
tarea 27: Implementar filtros avanzados en tabla de alumnos y conservar búsqueda global. (COMPLETADA)

TAREAS PENDIENTES DE REVISIÓN
tarea 28: Optimización visual del Dashboard del Profesor (Reducir márgenes, ajustar columnas, reposicionar buscador y botón regresar). (COMPLETADA)
tarea 29: Implementación de navegación directa sin botones, pestaña de exámenes, tablas responsivas, ajuste de tipografía y optimización de footer/hero. (COMPLETADA)
- Tarea [A-13 / P-01]: Corrección de ReferenceError en renderDetalles. (COMPLETADA)
- Tarea [A-14]: Restauración de timer y fullscreen en exámenes. (COMPLETADA)
- Tarea [A-15]: Corrección de redirección en exámenes. (COMPLETADA)
- Tarea [A-16]: Centralización de Mobile Nav en ui-common.js. (COMPLETADA)
- Tarea [A-17 / P-03]: Eliminación de exam-results.html y js. (COMPLETADA)
- Tarea [A-18 / P-02]: Limpieza de código muerto en teacher dashboard. (COMPLETADA)
- Tarea [A-19]: Eliminación de js/main.js. (COMPLETADA)
- Tarea [A-20]: Actualización global de URLs de producción. (COMPLETADA)
- Tarea [A-21]: Corrección de erratas en data.js. (COMPLETADA)
- Tarea [A-22]: Implementación de eliminación de archivos en subida. (COMPLETADA)
- Tarea [A-23]: Eliminación de backend.gs legacy. (COMPLETADA)
- Tarea [P-04]: Aplicación de filtro de pendientes en vista de detalles. (COMPLETADA)
________________________________________________________________________________________________
tarea 9: Corregir lógica de renderizado de preguntas Verdadero/Falso y Término Pareado, y habilitar visualización detallada de resultados. (COMPLETADA)
tarea 11: Actualizar URLs de servicios, implementar ocultación de resultados de examen hasta revisión docente y estandarizar lógica de feedback en el dashboard del estudiante. (COMPLETADA)
tarea 12: Implementar restricción de acceso para profesores, mejorar legibilidad de IDs y lógica de visibilidad de secciones. (COMPLETADA)
tarea 13: Actualizar URLs de los microservicios TASK y EXAM a las nuevas implementaciones finales. (COMPLETADA)
tarea 14: Actualizar las URLs de producción definitivas para los microservicios USER, TASK y EXAM. (COMPLETADA)
tarea 15: Corregir fuga de aislamiento entre profesores y visualización de metadatos "N/A" en el dashboard docente. (COMPLETADA)
tarea 16: Actualizar URLs de producción para TASK y EXAM (...2Ss y ...8Kr). (COMPLETADA)
tarea 17: Implementar botón de instalación de PWA en menú móvil y pie de página y mejorar visibilidad. (COMPLETADA)
tarea 18: Implementar modal de login y sección de acceso (Portal/Iniciar Sesión) en index.html sin afectar secciones existentes. (COMPLETADA)
tarea 19: Unificación total de encabezados y pies de página, reducción de márgenes y gaps, y estandarización visual en dashboards y exámenes. (COMPLETADA)
tarea 20: Implementar navegación jerárquica y filtrado avanzado en el Dashboard del Profesor (navStack, filtros, títulos dinámicos). (COMPLETADA)
tarea 21: Optimizar accesibilidad móvil asegurando un área de toque mínima de 44px para todos los elementos interactivos. (COMPLETADA)
tarea 22: Corregir normalización de metadatos (grado vs gradoAsignado) en el dashboard del profesor para asegurar visibilidad de exámenes sin entregas en la jerarquía. (COMPLETADA)
tarea 23: Implementar limpieza automática del buscador al cambiar de nivel en la navegación jerárquica del dashboard docente. (COMPLETADA)

TAREAS PENDIENTES
________________________________________________________________________________________________

TAREA: [F-01]
ARCHIVO: backend/exam-service/Code.gs, js/teacher.js, js/exam.js
UBICACIÓN: submitExam, creación de exámenes, renderQuestion
ÁREA: Backend / Frontend / Lógica
PRIORIDAD: ALTA

PROBLEMA A RESOLVER:
Lógica incompleta para tipos de preguntas avanzados. "Selección múltiple" no existe (solo opción única), "Término pareado" y "Respuesta breve" no se califican automáticamente. La interfaz de creación no soporta respuestas complejas.

ACCIONES REQUERIDAS:
- Implementar el tipo "Selección múltiple" (Checkboxes) permitiendo múltiples respuestas correctas.
- Refactorizar el backend para calificar "Término pareado" (comparando el objeto de pares) y "Respuesta breve".
- Actualizar el formulario de creación de exámenes para capturar correctamente las soluciones de estos nuevos tipos.

REGLAS:
- Mantener compatibilidad con los exámenes ya creados.
- Asegurar que el cálculo de la nota final (0-100) sea preciso para todos los tipos.

CRITERIO DE ACEPTACIÓN:
- Un examen con preguntas de emparejamiento y selección múltiple se califica automáticamente y de forma correcta al ser entregado.

--------------------------------------------------

TAREA: [F-02]
ARCHIVO: js/teacher.js
UBICACIÓN: Navegación (navStack / renderCurrentLevel)
ÁREA: Frontend / UX
PRIORIDAD: CRÍTICA

PROBLEMA A RESOLVER:
La vista de gestión de exámenes (Activar/Bloquear) es inalcanzable desde la interfaz de usuario. Las funciones existen pero no hay un botón o ruta para activarlas.

ACCIONES REQUERIDAS:
- Añadir un punto de entrada en la jerarquía de navegación para acceder a 'Exámenes' (gestión).
- Puede ser un botón en el nivel de 'Asignaturas' o una opción dentro de la pestaña de 'Alumnos' -> 'Exámenes'.
- Asegurar que pushNav('Exámenes', data) se ejecute correctamente.

REGLAS:
- No romper la navegación jerárquica existente.
- Mantener la consistencia visual del dashboard.

CRITERIO DE ACEPTACIÓN:
- El profesor puede navegar hasta una vista donde se listan los exámenes de una asignatura y puede usar los botones "Activar" y "Bloquear" funcionalmente.

--------------------------------------------------

TAREA: [F-03]
ARCHIVO: backend/task-service/Code.gs
UBICACIÓN: submitAssignment
ÁREA: Backend / Seguridad
PRIORIDAD: MEDIA

PROBLEMA A RESOLVER:
El alumno puede reenviar tareas múltiples veces llamando directamente a la API, ya que el backend no valida si ya existe una entrega para el par (userId, tareaId).

ACCIONES REQUERIDAS:
- Modificar submitAssignment para que verifique en la hoja 'Entregas' si el usuario ya realizó una entrega para esa tarea específica.
- Si ya existe, debe devolver un error o actualizar la entrega existente en lugar de crear un duplicado (definir política de negocio).

REGLAS:
- No afectar el rendimiento de la subida de archivos.
- Devolver mensajes de error claros al frontend.

CRITERIO DE ACEPTACIÓN:
- Al intentar realizar una entrega de una tarea ya entregada por API, el sistema devuelve un estado de error y no duplica la fila en la hoja de cálculo.

--------------------------------------------------

TAREA: [F-04]
ARCHIVO: js/teacher.js, backend/user-service/Code.gs (o similar)
UBICACIÓN: Header del dashboard / Nueva función de búsqueda
ÁREA: Frontend / Backend / UX
PRIORIDAD: ALTA

PROBLEMA A RESOLVER:
La búsqueda es contextual y limitada al nivel actual. No existe una búsqueda global de alumnos que permita encontrarlos rápidamente a través de toda la institución.

ACCIONES REQUERIDAS:
- Implementar una barra de búsqueda global (o mejorar la existente) que consulte la base de datos completa de estudiantes.
- Los resultados deben mostrar Nombre, Grado, Sección y ser clickeables.
- Al hacer clic en un resultado, debe llevar directamente a la vista de 'Detalles' de ese alumno, mostrando todas sus entregas de todas sus asignaturas (o una vista unificada).

REGLAS:
- La búsqueda global no debe interferir con el filtrado contextual de las tablas si se mantienen ambas.
- Respetar la privacidad: un profesor solo debe encontrar alumnos a los que tiene acceso si se requiere (o búsqueda total si es administrativo).

CRITERIO DE ACEPTACIÓN:
- Escribir el nombre de un alumno en la búsqueda desde cualquier nivel (ej. desde Grados) y que aparezca el resultado correcto permitiendo ir a sus detalles.

--------------------------------------------------

TAREA: [F-05]
ARCHIVO: js/student.js, student-dashboard.html
UBICACIÓN: Modal de entrega / fileInput listener
ÁREA: Frontend / UX
PRIORIDAD: BAJA

PROBLEMA A RESOLVER:
La vista previa solo soporta imágenes. Los documentos (PDF, Word) no muestran una previsualización del contenido, dificultando la verificación del archivo seleccionado por el alumno.

ACCIONES REQUERIDAS:
- Implementar previsualización para archivos PDF (usando un iframe o similar).
- Para archivos Word, mejorar el feedback visual mostrando un icono representativo y más detalles del archivo.

REGLAS:
- No sobrecargar el modal.
- Mantener la compatibilidad con dispositivos móviles.

CRITERIO DE ACEPTACIÓN:
- Al seleccionar un PDF, el alumno puede ver una miniatura o vista previa del documento dentro del modal de entrega.

--------------------------------------------------
