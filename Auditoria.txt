
**Archivo: index.html**

*   **Componente: Global**
    *   **Problema:** Dependencia de CDN externas para Tailwind CSS y Google Fonts.
    *   **Descripción:** Investigar la posibilidad de alojar localmente estas dependencias o utilizar un proceso de build (como PostCSS) para generar un archivo CSS optimizado y eliminar dependencias externas en producción.
    *   **Referencia:** Archivo: index.html, Línea(s): 7, 8
    *   **Problema:** Bloque de CSS personalizado dentro del HTML.
    *   **Descripción:** Mover todo el CSS del bloque `<style>` a un archivo CSS externo (ej. `css/custom.css`) y enlazarlo en el `<head>`.
    *   **Referencia:** Archivo: index.html, Línea(s): 9-195
    *   **Problema:** Datos de contenido (`presentationData`, etc.) hardcodeados en el script.
    *   **Descripción:** Mover los datos de los menús y descargas a archivos JSON dedicados (ej. `data/presentations.json`) y cargarlos con `fetch`.
    *   **Referencia:** Archivo: index.html, Línea(s): 412, 494, 574
    *   **Problema:** Todo el código JavaScript está en un solo bloque `<script>`.
    *   **Descripción:** Modularizar el JavaScript. Mover la lógica principal a un archivo externo (ej. `js/main.js`) y considerar separar la lógica de los juegos también.
    *   **Referencia:** Archivo: index.html, Línea(s): 412-1110
    *   **Problema:** El header y el footer están hardcodeados.
    *   **Descripción:** Extraer el HTML del header y el footer a componentes reutilizables (ej. `_header.html`, `_footer.html`) que puedan ser cargados dinámicamente en todas las páginas.
    *   **Referencia:** Archivo: index.html, Línea(s): 199-281, 399-410

*   **Componente: Menú de Navegación**
    *   **Problema:** Enlace roto a "Pseudocódigo" en el menú móvil.
    *   **Descripción:** Corregir el `href` del enlace "Pseudocódigo" en el menú móvil para que apunte a `pseudocode.html` en lugar de `pseudocode.js`.
    *   **Referencia:** Archivo: index.html, Línea(s): 273
    *   **Problema:** Lógica de renderizado de menús duplicada (`renderDesktopNav`, `renderMobileNav`).
    *   **Descripción:** Refactorizar la generación de menús para reutilizar la lógica de iteración sobre las estructuras de datos y solo diferenciar la salida de HTML.
    *   **Referencia:** Archivo: index.html, Línea(s): 768-963

*   **Componente: Carga de Juegos**
    *   **Problema:** Funciones para cargar juegos (`loadPeripheralsGame`, etc.) son casi idénticas.
    *   **Descripción:** Crear una única función `loadGame(gameInfo)` que acepte un objeto con los detalles del juego (nombre de archivo html/js, función de inicialización) para eliminar la duplicación de código.
    *   **Referencia:** Archivo: index.html, Línea(s): 1205-1296


**Archivo: teacher-dashboard.html**

*   **Componente: Global**
    *   **Problema:** Falta de header y footer reutilizables.
    *   **Descripción:** La página no utiliza un sistema de componentes, duplicando la necesidad de gestionar un header y footer si se añadieran.
    *   **Referencia:** Archivo: teacher-dashboard.html
    *   **Problema:** Dependencia de CDN para Tailwind CSS.
    *   **Descripción:** Al igual que en index.html, se depende de un CDN externo.
    *   **Referencia:** Archivo: teacher-dashboard.html, Línea(s): 6
    *   **Problema:** Falta de indicador de carga y estado vacío en la tabla de entregas.
    *   **Descripción:** Añadir una fila en la tabla que indique "Cargando..." y otra para "No hay entregas".
    *   **Referencia:** Archivo: teacher-dashboard.html, Línea(s): 45

*   **Componente: Formularios**
    *   **Problema:** Inconsistencia en el campo "Grado Asignado".
    *   **Descripción:** El campo en el formulario de crear tarea es un `input` de texto, mientras que en el de crear examen es un `<select>`. Deberían ser ambos `<select>` para consistencia de datos.
    *   **Referencia:** Archivo: teacher-dashboard.html, Línea(s): 101, 150-155
    *   **Problema:** Campo "Sección" es de texto libre.
    *   **Descripción:** Cambiar los campos de "Sección" a `<select>` con opciones predefinidas para garantizar la consistencia.
    *   **Referencia:** Archivo: teacher-dashboard.html, Línea(s): 105, 159

**Archivo: js/teacher.js**

*   **Servicio: Lógica General**
    *   **Problema:** Función `fetchApi` duplicada.
    *   **Descripción:** La función `fetchApi` está definida localmente. Debería moverse a un archivo de utilidades compartido para ser reutilizada.
    *   **Referencia:** Archivo: js/teacher.js, Línea(s): 7-20
    *   **Problema:** Uso de `alert()` para retroalimentación.
    *   **Descripción:** Reemplazar todas las llamadas a `alert()` por un sistema de notificaciones no bloqueante en el UI.
    *   **Referencia:** Archivo: js/teacher.js, (e.g., Línea 143, 150, etc.)

*   **Servicio: Dashboard de Profesor**
    *   **Problema:** Vulnerabilidad XSS en `renderActivity`.
    *   **Descripción:** La función construye HTML como strings y usa `innerHTML`, lo que es inseguro. Se debe refactorizar para crear elementos del DOM de forma segura (usando `document.createElement` y `textContent`).
    *   **Referencia:** Archivo: js/teacher.js, Línea(s): 80
    *   **Problema:** Contaminación del scope global con `window.reactivateExam` y `window.openGradeModal`.
    *   **Descripción:** Eliminar los `onclick` en el HTML generado y usar delegación de eventos en el `submissionsTableBody` para manejar los clics en los botones.
    *   **Referencia:** Archivo: js/teacher.js, Línea(s): 161, 171
    *   **Problema:** Falta de validación en el formulario de crear examen.
    *   **Descripción:** El formulario de examen puede ser enviado sin preguntas. Añadir una validación en el `submit` para requerir al menos una pregunta.
    *   **Referencia:** Archivo: js/teacher.js, Línea(s): 215


**Archivo: backend.gs**

*   **Función: Global**
    *   **Problema:** IDs de configuración (SPREADSHEET_ID, DRIVE_FOLDER_ID) están hardcodeados.
    *   **Descripción:** Externalizar la configuración para no tener que modificar el código fuente al cambiar de entorno.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 2-3

*   **Función: doPost**
    *   **Problema:** El bloque `catch` expone mensajes de error detallados al cliente.
    *   **Descripción:** Implementar un manejo de errores que registre los detalles en el servidor (Logger.log) y devuelva un mensaje genérico al cliente.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 74-75

*   **Función: registerUser**
    *   **Problema:** Hashing de contraseña sin "salt".
    *   **Descripción:** Modificar el proceso de hashing para incluir un "salt" único por usuario, que se almacenará junto a la contraseña hasheada.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 81-83
    *   **Problema:** Generación de `userId` basada en `new Date().getTime()`.
    *   **Descripción:** Reemplazar la generación de IDs por un método que garantice mayor unicidad, como `Utilities.getUuid()`.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 80
    *   **Problema:** Falta de validación de datos en el payload de entrada.
    *   **Descripción:** Añadir validaciones para asegurar que los campos `nombre`, `email` y `password` no estén vacíos y que el email tenga un formato válido.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 79
    *   **Problema:** No se verifica la existencia previa de un email.
    *   **Descripción:** Antes de insertar un nuevo usuario, realizar una búsqueda en la hoja `Usuarios` para comprobar que el email no esté ya registrado.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 85

*   **Función: loginUser**
    *   **Problema:** Carga completa de la hoja de usuarios para buscar coincidencias.
    *   **Descripción:** Optimizar la búsqueda de usuarios, posiblemente utilizando filtros o una estrategia que no requiera cargar toda la base de datos en memoria.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 92-93

*   **Función: createTask**
    *   **Problema:** Falta de validación de datos en el payload de entrada.
    *   **Descripción:** Implementar validaciones para los campos clave de una tarea, como `titulo`, `parcial`, `asignatura` y `fechaLimite`.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 112

*   **Función: getStudentTasks**
    *   **Problema:** Carga completa de las hojas `Tareas` y `Entregas`.
    *   **Descripción:** Refactorizar la función para filtrar los datos de manera más eficiente, minimizando la cantidad de datos traídos a memoria.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 119-120

*   **Función: submitAssignment**
    *   **Problema:** Búsqueda ineficiente de usuario y tarea cargando hojas completas.
    *   **Descripción:** Optimizar la obtención de datos del usuario y la tarea para evitar cargar las hojas completas.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 161, 166
    *   **Problema:** Extracción de tipo MIME frágil con expresión regular.
    *   **Descripción:** Hacer más robusta la lógica de extracción del tipo MIME para manejar diferentes formatos de data URL.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 180

*   **Función: getTeacherActivity**
    *   **Problema:** Carga de 5 hojas de cálculo completas en memoria.
    *   **Descripción:** Optimizar drásticamente la función, posiblemente creando índices manuales (objetos JS) o pre-procesando los datos para evitar "joins" en tiempo de ejecución.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 193-197, 212
    *   **Problema:** Uso de `toLocaleString()` dependiente del servidor.
    *   **Descripción:** Devolver las fechas en un formato estándar (ISO 8601) y dejar que el frontend se encargue de formatearlas según la zona horaria del usuario.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 230

*   **Función: reactivateExam**
    *   **Problema:** Uso de índice de columna hardcodeado (número mágico).
    *   **Descripción:** Reemplazar el `getRange(i + 1, 7)` por un método que obtenga el índice de la columna "Estado" por su nombre, haciéndolo resistente a cambios en la estructura de la hoja.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 238

*   **Función: gradeSubmission**
    *   **Problema:** Uso de índices de columna hardcodeados.
    *   **Descripción:** Refactorizar para obtener los índices de las columnas "Calificación", "Estado" y "Comentario" por sus nombres.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 248-250

*   **Función: createExam**
    *   **Problema:** Generación de `preguntaId` no garantiza unicidad.
    *   **Descripción:** Utilizar `Utilities.getUuid()` para generar los IDs de las preguntas.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 369

*   **Función: submitExam**
    *   **Problema:** No se califican preguntas de tipo 'termino_pareado' y 'respuesta_breve'.
    *   **Descripción:** Implementar la lógica de calificación para los tipos de pregunta que actualmente se omiten.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 353
    *   **Problema:** Potencial división por cero si un examen no tiene preguntas.
    *   **Descripción:** Añadir una comprobación para evitar la división por cero si `preguntasDelExamen.length` es 0.
    *   **Referencia:** Archivo: backend.gs, Línea(s): 362
