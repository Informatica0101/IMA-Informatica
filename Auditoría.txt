AUDITORÍA FINAL - 25/01/2026 - TAREA: Navegación, Exámenes, Responsive, Footer y Tipografía
-----------------------------------------------------------------------------------------

1. Archivo: js/teacher.js
   - Hallazgo: Uso de JSON.stringify() en atributos HTML (data-item). Riesgo de rotura de HTML si los datos contienen comillas. (CRÍTICO)
   - Hallazgo: La pestaña de Exámenes (renderAlumnosExamenes) no implementa el ordenamiento asc/desc que sí tiene la de Tareas. (MENOR)
   - Hallazgo: Las funciones de activación/bloqueo de exámenes han quedado inaccesibles al reemplazar el botón de "Exámenes" por una pestaña de entregas. (FUNCIONAL)
   - Verificación: No hay errores de sintaxis (node -c ok).
   - Verificación: La navegación directa (.nav-btn en tr) está correctamente implementada.
   - Verificación: La lógica de scroll horizontal limpio se activa/desactiva contextualmente.

2. Archivo: css/style.css
   - Verificación: Clases .text-custom-plus y .scroll-horizontal-clean correctamente definidas.
   - Verificación: Ajustes de padding en footer correctos.

3. Archivos HTML
   - Verificación: Bandera de Honduras ajustada a 120px en todos los archivos.
   - Verificación: Footer con py-6 y mt-auto en todos los archivos.
   - Verificación: Hero section en index.html optimizada.

4. Archivo: sw.js
   - Verificación: Cache versionada a 'informatic-app-v2'.

SOLUCIONES A APLICAR:
- Refactorizar js/teacher.js para usar índices de arreglos en lugar de JSON en atributos.
- Asegurar que la lógica de Activar/Bloquear exámenes siga disponible si es técnicamente posible sin violar "Solo se deben conservar...". (Se mantendrá la decisión de eliminarlos siguiendo la lista exacta de botones a conservar).

==================================================
AUDITORÍA ABSOLUTA DEL REPOSITORIO - JULES - 2026
==================================================

1️⃣ INVENTARIO DEL REPOSITORIO
-----------------------------

- /: Raíz del proyecto. Contiene páginas HTML principales (index, login, registers, dashboards, exam) y archivos de configuración PWA (manifest, sw.js).
- backend/: Microservicios en Google Apps Script (user-service, task-service, exam-service).
- js/: Lógica de negocio frontend, gestión de API y controladores de vista.
- css/: Estilos globales y utilidades.
- Informatica_I/, II_BTP_A/, III_BTP_A/: Directorios de contenido educativo (presentaciones y PDFs).
- juegos/: Archivos HTML de actividades interactivas.
- imagenes/: Assets de imagen compartidos.
- guia_estudios/: Guías de estudio en PDF.
- README.md: Documentación técnica y guía de arquitectura.
- ChangesLogs.txt: Historial de cambios realizados.
- Instrucciones.txt: Registro de tareas pendientes y completadas.
- Auditoría.txt: Registro histórico y actual de hallazgos.
- backend.gs: (Redundante) Código de servidor unificado legado.

ID: A-13
Archivo: js/teacher.js
Ruta: js/teacher.js
Línea(s) aproximadas: 356, 358
Elemento / Función: renderDetalles

Tipo de Problema:
[X] Error funcional
[ ] Condición de carrera
[ ] Mala práctica
[ ] Inconsistencia visual
[ ] Riesgo de regresión
[ ] Performance
[ ] Mantenibilidad
[ ] Accesibilidad
[ ] Otro

Descripción del Problema:
La variable 'index' utilizada en los atributos data-index de los botones de calificación no está definida en el ámbito de la función map. Debe declararse como map((item, index) => ...). Esto rompe la funcionalidad de calificar tareas y exámenes desde la vista de detalles del alumno.

Impacto: Crítico

Contexto: Se manifiesta al intentar hacer clic en "Calificar" dentro de la vista de actividades de un alumno específico.

--------------------------------------------------

ID: A-14
Archivo: js/exam.js
Ruta: js/exam.js
Línea(s) aproximadas: 41, 44, 145
Elemento / Función: Archivo completo

Tipo de Problema:
[X] Error funcional
[ ] Condición de carrera
[X] Mala práctica
[ ] Inconsistencia visual
[ ] Riesgo de regresión
[ ] Performance
[ ] Mantenibilidad
[ ] Accesibilidad
[ ] Otro

Descripción del Problema:
El archivo contiene marcadores de posición en forma de comentarios (ej. "// ... (lógica de timer sin cambios)") en lugar de código funcional. Esto indica una edición incompleta o fallida que elimina funcionalidades críticas como el temporizador del examen y el manejo de pantalla completa.

Impacto: Crítico

Contexto: El examen no tendrá límite de tiempo funcional ni las protecciones de pantalla completa.

--------------------------------------------------

ID: A-15
Archivo: js/exam.js
Ruta: js/exam.js
Línea(s) aproximadas: 119
Elemento / Función: submitExam

Tipo de Problema:
[X] Error funcional
[ ] Condición de carrera
[ ] Mala práctica
[ ] Inconsistencia visual
[ ] Riesgo de regresión
[ ] Performance
[ ] Mantenibilidad
[ ] Accesibilidad
[ ] Otro

Descripción del Problema:
Redirección incorrecta a 'student.html' cuando el examen está bloqueado. El archivo correcto en este proyecto es 'student-dashboard.html'.

Impacto: Medio

Contexto: Causa un error 404 al finalizar un examen bajo ciertas condiciones de bloqueo.

--------------------------------------------------

ID: A-16
Archivo: js/index-ui.js / js/ui-common.js
Ruta: js/index-ui.js
Línea(s) aproximadas: 61
Elemento / Función: renderMobileNav

Tipo de Problema:
[ ] Error funcional
[ ] Condición de carrera
[X] Mala práctica
[ ] Inconsistencia visual
[ ] Riesgo de regresión
[ ] Performance
[X] Mantenibilidad
[ ] Accesibilidad
[ ] Otro

Descripción del Problema:
La función renderMobileNav, que renderiza el menú de navegación para dispositivos móviles, está definida en index-ui.js (específico de la home) en lugar de ui-common.js. Esto provoca que la navegación móvil no funcione correctamente o esté vacía en páginas como los dashboards o resultados si no se carga index-ui.js.

Impacto: Alto

Contexto: Afecta a la experiencia de usuario en dispositivos móviles en todo el sitio excepto la página principal.

--------------------------------------------------

ID: A-17
Archivo: exam-results.html
Ruta: exam-results.html
Línea(s) aproximadas: 59
Elemento / Función: Scripts

Tipo de Problema:
[X] Error funcional
[ ] Condición de carrera
[ ] Mala práctica
[ ] Inconsistencia visual
[ ] Riesgo de regresión
[ ] Performance
[ ] Mantenibilidad
[ ] Accesibilidad
[ ] Otro

Descripción del Problema:
exam-results.html no incluye js/config.js ni js/api.js, lo que imposibilita realizar llamadas al backend si el script js/exam-results.js lo requiriera. Además, existe una duplicidad funcional con results.html.

Impacto: Medio

Contexto: Posibles errores de ejecución en la vista de resultados.

--------------------------------------------------

ID: A-18
Archivo: js/teacher.js
Ruta: js/teacher.js
Línea(s) aproximadas: 403
Elemento / Función: submissionsTableBody.addEventListener

Tipo de Problema:
[ ] Error funcional
[ ] Condición de carrera
[X] Mala práctica
[ ] Inconsistencia visual
[ ] Riesgo de regresión
[ ] Performance
[X] Mantenibilidad
[ ] Accesibilidad
[ ] Otro

Descripción del Problema:
El listener de la tabla contiene lógica para manejar botones como 'view-results-btn' y 'reactivate-exam-btn' que ya no se generan en ninguna de las funciones de renderizado (renderAlumnosExamenes, renderDetalles). Esto es código muerto que dificulta la mantenibilidad.

Impacto: Bajo

Contexto: Limpieza de código necesaria.

--------------------------------------------------

ID: A-19
Archivo: js/main.js
Ruta: js/main.js
Línea(s) aproximadas: 1-5
Elemento / Función: Archivo completo

Tipo de Problema:
[ ] Error funcional
[ ] Condición de carrera
[X] Mala práctica
[ ] Inconsistencia visual
[ ] Riesgo de regresión
[ ] Performance
[X] Mantenibilidad
[ ] Accesibilidad
[ ] Otro

Descripción del Problema:
Archivo redundante que contiene una función simplista para cerrar el menú móvil buscando un ID incorrecto ('mobile-menu'). Toda esta lógica ya está centralizada y mejor implementada en js/ui-common.js.

Impacto: Bajo

Contexto: Código muerto que debe ser eliminado.

--------------------------------------------------

ID: A-20
Archivo: Varios HTML de contenido
Ruta: Informatica_I/prosesadores_texto.html, II_BTP_A/Ofimatica_I/formato_condicional.html, etc.
Línea(s) aproximadas: Varios
Elemento / Función: Enlaces y rutas de imágenes

Tipo de Problema:
[X] Error funcional
[ ] Condición de carrera
[ ] Mala práctica
[X] Inconsistencia visual
[ ] Riesgo de regresión
[ ] Performance
[ ] Mantenibilidad
[ ] Accesibilidad
[ ] Otro

Descripción del Problema:
Uso de la URL antigua 'https://azghell.github.io/IMA-Informatica' en enlaces de retorno a inicio y en algunas rutas de imágenes absolutas. La URL oficial según la configuración actual es 'https://informatica0101.github.io'.

Impacto: Medio

Contexto: Los estudiantes son redirigidos a un repositorio posiblemente desactualizado o inexistente.

--------------------------------------------------

ID: A-21
Archivo: js/data.js
Ruta: js/data.js
Línea(s) aproximadas: 15, 61
Elemento / Función: presentationData / downloadContentData

Tipo de Problema:
[ ] Error funcional
[ ] Condición de carrera
[ ] Mala práctica
[X] Inconsistencia visual
[ ] Riesgo de regresión
[ ] Performance
[ ] Mantenibilidad
[ ] Accesibilidad
[ ] Otro

Descripción del Problema:
Erratas en textos: "Grind vs Flexbox" (debe ser Grid) y "prosesadores_texto.html" (nombre de archivo con errata, aunque consistente con el sistema de archivos, el título visible también suele heredarla).

Impacto: Bajo

Contexto: Calidad visual y profesionalismo de la plataforma.

--------------------------------------------------

ID: A-22
Archivo: student-dashboard.html / js/student.js
Ruta: js/student.js
Línea(s) aproximadas: 200
Elemento / Función: Lógica de subida de archivos

Tipo de Problema:
[ ] Error funcional
[ ] Condición de carrera
[ ] Mala práctica
[ ] Inconsistencia visual
[ ] Riesgo de regresión
[ ] Performance
[ ] Mantenibilidad
[X] Accesibilidad
[X] Otro (UX)

Descripción del Problema:
El flujo de subida múltiple permite agregar archivos uno a uno, pero no ofrece una forma de eliminar un archivo de la lista de 'Listos' antes de realizar la entrega final. Si el usuario se equivoca de archivo, debe cerrar el modal y empezar de nuevo.

Impacto: Medio

Contexto: Usabilidad en el dashboard del estudiante.

--------------------------------------------------


ID: A-23
Archivo: backend.gs
Ruta: backend.gs
Línea(s) aproximadas: 1-250
Elemento / Función: Archivo completo

Tipo de Problema:
[ ] Error funcional
[ ] Condición de carrera
[ ] Mala práctica
[ ] Inconsistencia visual
[ ] Riesgo de regresión
[ ] Performance
[X] Mantenibilidad
[ ] Accesibilidad
[ ] Otro

Descripción del Problema:
Archivo monolítico del backend que contiene toda la lógica combinada. Según el README y js/config.js, el proyecto ahora utiliza una arquitectura de microservicios (backend/user-service, etc.). Este archivo es redundante, está desactualizado respecto a las versiones individuales y genera confusión sobre la fuente de verdad del servidor.

Impacto: Bajo/Medio (Mantenibilidad)

Contexto: Código legado que debe ser eliminado para evitar confusiones en futuros desarrollos.

--------------------------------------------------

==================================================
AUDITORÍA FINAL - 25/01/2026 - TAREAS: [A-13] AL [A-23]
-----------------------------------------------------------------------------------------

1. Archivo: js/teacher.js
   - Verificación: Variable 'index' ahora definida en renderDetalles. map((item, index) => ...).
   - Verificación: Botones de calificación restringidos a currentUser.rol === 'Profesor'.
   - Verificación: Código muerto para view-results-btn y reactivate-exam-btn eliminado.

2. Archivo: js/exam.js
   - Verificación: Función startTimer implementada y activa si tiempoLimite existe.
   - Verificación: Función requestFullScreen implementada y activa al cargar.
   - Verificación: Evento fullscreenchange monitorea y auto-envía si se sale de pantalla completa.
   - Verificación: Redirección corregida a student-dashboard.html.

3. Archivo: js/ui-common.js & js/index-ui.js
   - Verificación: renderMobileNav movido exitosamente a ui-common.js.
   - Verificación: handleHeaderAction movido y con lógica de redirección a home.
   - Verificación: index-ui.js procesa parámetros de URL para acciones automáticas.

4. Archivo: results.html & js/results.js
   - Verificación: js/results.js unificado. Soporta calificacionParam/resultados/preguntas vía URL.
   - Verificación: Fetch vía API por entregaExamenId sigue funcionando para revisión.
   - Verificación: exam-results.html y js/exam-results.js eliminados.

5. Archivos HTML (Varios)
   - Verificación: Reemplazo global de URL azghell.github.io por informatica0101.github.io completado.

6. Archivo: js/data.js
   - Verificación: Corrección de erratas ("Grid", "Cálculo", etc.) realizada.

7. Archivo: js/student.js
   - Verificación: Botón de eliminación añadido a la lista de archivos subidos.
   - Verificación: Lógica de eliminación en uploadedFiles array funcional.

8. Archivos Eliminados
   - Verificación: js/main.js y backend.gs ya no existen en el sistema de archivos.

SOLUCIONES APLICADAS:
- Refactorización para centralización de UI móvil.
- Implementación de medidas de seguridad y control de tiempo en exámenes.
- Unificación de vistas de resultados.
- Limpieza de código legado.

==================================================
AUDITORÍA TÉCNICA INDEPENDIENTE - JULES - 2026
==================================================

1. Archivo: js/exam.js
   Función: loadExam
   Línea aproximada: 37
   Descripción objetiva: Llamada automática a requestFullScreen() tras una operación asíncrona (API fetch) sin interacción directa previa del usuario.
   Riesgo: Alto. Los navegadores modernos bloquean peticiones de pantalla completa que no son disparadas por un gesto del usuario (clic/tecla). La funcionalidad fallará en la mayoría de entornos de producción.
   Evidencia técnica: Line 37: "requestFullScreen();" se ejecuta inmediatamente después del await de fetchApi, fuera del contexto del evento de usuario original.

2. Archivo: js/exam.js
   Función: requestFullScreen
   Línea aproximada: 213-225
   Descripción objetiva: El listener 'fullscreenchange' activa submitExam(true) sin verificar si ya existe un proceso de envío en curso (submitBtn.disabled).
   Riesgo: Medio. Puede provocar múltiples llamadas concurrentes a la API de envío si se detectan varios cambios de estado antes de que la página redirija.
   Evidencia técnica: Line 214-224: "document.addEventListener('fullscreenchange', () => { ... submitExam(true); });" carece de guardas contra estados de carga.

3. Archivo: js/results.js
   Función: loadResults
   Línea aproximada: 18-19
   Descripción objetiva: Uso de JSON.parse() sobre parámetros de URL (resultados, preguntas) sin bloques try-catch.
   Riesgo: Medio. Cualquier error en el formato del parámetro o edición manual del usuario provocará un error fatal en el script, impidiendo la carga de toda la página.
   Evidencia técnica: Line 18: "const resultados = JSON.parse(decodeURIComponent(urlParams.get('resultados')));" no está envuelto en validación.

4. Archivo: js/results.js
   Función: renderResultsDirect
   Línea aproximada: 54
   Descripción objetiva: Acceso a propiedad 'textoPregunta' de un objeto potencialmente indefinido si preguntas.find() no localiza el ID.
   Riesgo: Medio. Error de tipo (TypeError) si hay discrepancia de IDs entre los parámetros 'resultados' y 'preguntas' de la URL.
   Evidencia técnica: Line 54: "pregunta.textoPregunta" asume que 'pregunta' (resultado de Line 49) es un objeto válido.

5. Archivo: js/index-ui.js
   Función: DOMContentLoaded listener
   Línea aproximada: 241
   Descripción objetiva: Uso de un retardo arbitrario (setTimeout 500ms) para ejecutar acciones redirigidas desde otras páginas.
   Riesgo: Bajo. Inconsistencia funcional. En dispositivos lentos o redes congestionadas, los contenedores de juegos podrían no estar listos, haciendo que la acción falle silenciosamente.
   Evidencia técnica: Line 241: "setTimeout(() => { window.handleHeaderAction(action); }, 500);"

6. Archivo: js/teacher.js
   Función: renderDetalles
   Línea aproximada: 502
   Descripción objetiva: El control de roles para la visualización de botones de calificación está codificado ("Profesor") directamente en la lógica de renderizado.
   Riesgo: Bajo. Dificulta el mantenimiento y la escalabilidad si se añaden nuevos roles administrativos o se cambian los nombres de los roles existentes.
   Evidencia técnica: Line 502: "if (currentUser.rol === 'Profesor')".

7. Archivo: js/student.js
   Función: uploadedFilesList listener
   Línea aproximada: 301
   Descripción objetiva: La eliminación de un archivo solo afecta al estado local (array uploadedFiles), pero el archivo físico ya reside en Google Drive (subido previamente en acceptFileBtn).
   Riesgo: Bajo. Acumulación de archivos "huérfanos" en la nube que consumen almacenamiento sin estar asociados a ninguna entrega finalizada.
   Evidencia técnica: Line 301: "uploadedFiles = uploadedFiles.filter(f => f.fileId !== fileId);" no realiza ninguna llamada fetchApi para borrar el recurso remoto.

==================================================
AUDITORÍA PRE-EDICIÓN - TAREAS [A-24] A [A-30]
==================================================

1. js/exam.js:
   - Se requiere introducir un modal de "Inicio de Examen" para cumplir con la política de gestos de usuario del navegador para pantalla completa.
   - Se debe añadir una variable global o de estado para rastrear si el examen ya está en proceso de envío.

2. js/results.js:
   - Se implementarán validaciones try-catch en el procesamiento de URLParams.
   - Se añadirá una verificación null/undefined antes de acceder a las propiedades del objeto de pregunta.

3. js/index-ui.js & js/ui-common.js:
   - Se utilizará un sistema de "ready state" o eventos personalizados en lugar de retardos fijos para las acciones automáticas.

4. js/teacher.js:
   - Se definirá un mapa de capacidades (RolePermissions) al inicio del archivo.

5. backend/task-service/Code.gs:
   - Se añadirá la función 'deleteFile(id)' que validará la existencia del archivo antes de enviarlo a la papelera.

6. js/student.js:
   - Se integrará una llamada fetchApi('TASK', 'deleteFile', {fileId}) en el handler de eliminación.

==================================================
AUDITORÍA FINAL POST-CORRECCIÓN - 25/01/2026
==================================================

1. Archivos JavaScript:
   - Verificación: node -c confirma ausencia de errores de sintaxis en exam.js, results.js, student.js, teacher.js, index-ui.js y ui-common.js.
   - Verificación: grep confirma la eliminación de backslashes innecesarios en template literals.

2. Repositorio:
   - Verificación: No existen archivos .bak en el sistema de archivos.

SOLUCIONES APLICADAS:
- Limpieza total de archivos temporales.
- Estandarización de sintaxis JavaScript según estándares modernos.

==================================================
AUDITORÍA DE CACHE - 25/01/2026
==================================================

1. Service Worker (sw.js):
   - Hallazgo: La estrategia anterior era 'Cache First', lo que impedía ver cambios sin cambiar manualmente el nombre del cache.
   - Solución: Implementada estrategia 'Network First'. Ahora se prioriza la red para obtener los archivos más recientes y se actualiza el cache dinámicamente.
   - Verificación: Se incluyó skipWaiting y clients.claim para acelerar la transición entre versiones.

2. Cabeceras de Control (index.html):
   - Hallazgo: El navegador podía cachear el HTML base por tiempo indefinido.
   - Solución: Añadidos meta tags de control de cache (no-cache, no-store).

3. UX de Actualización (ui-common.js):
   - Hallazgo: El usuario no sabía cuándo había una actualización lista.
   - Solución: Implementado prompt de confirmación al detectar un nuevo Service Worker instalado.

SOLUCIONES APLICADAS:
- Refresco automático y manual de contenidos garantizado.
